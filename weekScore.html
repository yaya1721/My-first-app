<!DOCTYPE html>
<html>
<head>
<title></title>
 
 <script src="js/jquery-3.1.1.min.js"></script>
 <script src="js/bootstrap.min.js"></script>
 <script src="js/fdb-all.min.js"></script>
 <script src="js/main.js"></script>
 
 <link rel="stylesheet" href="css/bootstrap.css">
 <link rel="stylesheet" href="css/style.css">
 <link rel="shortcut icon" href="https://pbs.twimg.com/profile_images/631800387016626176/P5jbtPH5.png" type="image/x-icon" />
 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta charset="UTF-8">
 </head>
 <body>
<h1  style="text-align:center;">本周的成績</h1> 
<div>
 <table class="table table-hover" id=scoreTable >
        <thead>
            <tr>
               <td>日期</td>  <td>星期</td>  <td>科目</td>  
              <td>單元</td> <td>成績</td> <td>備註</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>  

<div>  
<table id="subjectTable" class='table table-hover'>
    <thead>
      <tr>
        <th>Subject</th>
        <th>Total Score</th>
        <th>Percent</th>
      </tr>
    </thead>
    <tbody>                  
    </tbody>
  </table>    
 </div>
  
  <!-- Modal2 -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">錯誤欄~</h4>
      </div>
      <div class="modal-body">
        <p id="test"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>
</div>
 
   
   
   
 <script>
 scoreCollection.load(
    var query;
    var date = new Date();
   switch (date.getDay()) {
    case 1: //MON
        query={
                date: {
                    "$gt": year+"-"+month+"-0"+1,
                    "$lt": year+"-"+nextmonth+"-0"+1
                }
            }
        break; 
    case 2: //TUE
        text = "Today is Sunday";
        break; 
    case 3: //WED
        text = "Today is Sunday";
        break; 
    case 4: //THURS
        text = "Today is Sunday";
         break; 
    default: //FRI SAT SUN
        text = "Looking forward to the Weekend";
}
    var result =scoreCollection.find(
    {},
    { $orderBy: {date:-1}, $limit: day} //Sunday=0
    )
   //列印資料  
  for(var i=0;i<result.length; i++){
    var scoredata= "<tr><td>" +result[i].date+"</td><td>"+result[i].weekday+"</td><td>"+result[i].subject+
        "</td><td>"+result[i].unit+"</td><td>"+result[i].score+ 
       "</td><td><button id='extraBtn' class=\"btn btn-default\" data-id='"+scoreCollection.find()[i]._id+"'>備註</button></td></tr>"
      $("tbody").append(scoredata);
   var totalScore =0;
   var sum = [0,0,0,0,0,0,0,0,0,0];
    var type = ["國文","英文","數學","物理","化學","生物","地科","歷史","地理","公民"];
     switch(result[i].type){
          case "國文":
            this.sum[0] = this.sum[0] + result[i].number/1
            break;
          case "英文":
            this.sum[1] = this.sum[1] + result[i].number/1
            break;
          case "數學":
            this.sum[2] = this.sum[2] + result[i].number/1
            break;
          case "物理":
            this.sum[3] = this.sum[3] + result[i].number/1
            break;
          case "化學":
            this.sum[4] = this.sum[4] + result[i].number/1
            break;
          case "生物":
            this.sum[5] = this.sum[5] + result[i].number/1
            break;
          case "地科":
            this.sum[6] = this.sum[6] + result[i].number/1
            break;
          case "歷史":
            this.sum[7] = this.sum[7] + result[i].number/1
            break;
          case "地理":
            this.sum[8] = this.sum[8] + result[i].number/1
            break;
          case "公民":
            this.sum[9] = this.sum[9] + result[i].number/1
        //default type!= all cases above 
          }
          totalScore = totalScore + result[i].number/1
        }
       countTypeTotal(totalScore);
      function countTypeTotal(totalScore){
        $("table#subjectTable").text("");
        for(var i=0;i<sum.length;i++){
            var commentdata = "<tr><td>"+type[i]+"</td><td>"+sum[i]+"</td><td>"+Math.round((sum[i]/totalScore)*100)+"%</td></tr>";
            $("table#subjectTable tbody").append(commentdata);
        }
  

  );
 
 //設定資料格式  
// var result =scoreCollection.find(
   //{},
   //{ $orderBy: {date:-1},$limit: 2}
  // );
   
 //列印資料  
  //for(var i=0;i<result.length; i++){
   // var scoredata= "<tr><td>" +result[i].date+"</td><td>"+result[i].weekday+"</td><td>"+result[i].subject+
      //  "</td><td>"+result[i].unit+"</td><td>"+result[i].score+ 
     //   "</td><td><button id='extraBtn' class=\"btn btn-default\" data-id='"+scoreCollection.find()[i]._id+"'>備註</button></td></tr>"
   //   $("tbody").append(scoredata);
 // }
    
    
  function extraModal(){
   $("#myModal2").modal();
   var scoreid = $(this).data("id");
   var query={
     _id: scoreid
    };
    $("#test").text(scoreCollection.find(query)[0].extra);
  }
  $("table").on("click","button#extraBtn",extraModal);
   
</script>  
</body>  
</html>
