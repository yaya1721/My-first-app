<!DOCTYPE html>
<html>
<head>
<title></title>
 
 <script src="js/jquery-3.1.1.min.js"></script>
 <script src="js/bootstrap.min.js"></script>
 <script src="js/fdb-all.min.js"></script>
 <script src="js/main.js"></script>
 
 <link rel="stylesheet" href="css/bootstrap.css">
 <link rel="stylesheet" href="css/style.css">
 <link rel="shortcut icon" href="https://pbs.twimg.com/profile_images/631800387016626176/P5jbtPH5.png" type="image/x-icon" />
 <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <meta charset="UTF-8">
 </head>
<body>
 <nav class="navbar navbar-default" style="margin-top:0x;">
  <div class="container-fluid">
    <div class="navbar-header">
      <!--picture here-->
    </div>
    <ul class="nav navbar-nav">
     <div class="btn-toolbar" role="toolbar">
      <div class="btn-group" role="group">
       <button type="button" class="btn btn-info" onclick='inputModalTrigger()' style="margin-left:5px;"><i class="material-icons">input</i>輸入成績</button>
       <button type="button" class="btn btn-warning" id="deleteBtn"><i class="material-icons">delete_forever</i></button>  
      </div>
     </div> 
    </ul>
  </div>
</nav>
 
<div>
 <table class="table table-hover" id=scoreTable >
        <thead>
            <tr>
                <td></td><td>日期</td>  <td>星期</td>  <td>科目</td>  
              <td>單元</td> <td>成績</td> <td>備註</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
 
 <!-- Modal for Input -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Input your score~</h4>
      </div>
      <div class="modal-body">
    <p style="text-align:center;">日期</p>
      <div class="row">
       <div class="col-lg-12">
         <input class="form-control" type="date" id="dateIpt">
       </div><!-- /.col-lg-6 -->
<br>
    <div class="col-lg-12">   
      <select id="weekdayS">
      <option value="">選擇星期</option>
      <option value="MON">一</option>
      <option value="TUE">二</option>
      <option value="WED">三</option>
      <option value="THUR">四</option>
      <option value="FRI">五</option>
      </select>
    </div><!-- /.col-lg-6 -->     
<br>
   <p style="text-align:center;">科目</p>
   <div class="col-lg-12">
      <input type="text" class="form-control" id="subjectIpt" required>
   </div><!-- /.col-lg-6 -->
<br>
   <p style="text-align:center;">單元</p>
   <div class="col-lg-12">
      <input type="text" class="form-control" id="unitIpt" required>
   </div><!-- /.col-lg-6 -->
       
<br>
   <p style="text-align:center;">成績</p>
   <div class="col-lg-12">
      <input type="number" class="form-control" id="scoreIpt" required>
   </div><!-- /.col-lg-6 -->
<br>
   <p style="text-align:center;">備註</p>
   <div class="col-lg-12">
      <input type="text" class="form-control" id="extraIpt" required>
   </div><!-- /.col-lg-6 -->
     <!-- 相機-->
   </div><!-- row -->   
      </div><!--molda body-->
      
     
     <div class="modal-footer">
       <button type="button" class="btn btn-primary" data-dismiss="modal" id="saveChanges" onclick='addCollection()'>Submit</button>
       <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
 
 
 <!-- Modal2 -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">錯誤欄~</h4>
      </div>
      <div class="modal-body">
        <p id="test"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
      </div>
    </div>
  </div>
</div>
 
 
 
 <script>
  scoreCollection.load(
   function(){
    for(var i=0;i<scoreCollection.find().length; i++){ 
     var scoredata ="<tr><td><input class='checkbox' type=\"radio\" value='"+scoreCollection.find()[i]._id+"'></td><td>"+scoreCollection.find()[i].date+
                     "</td><td>"+scoreCollection.find()[i].weekday+"</td><td>"+
     scoreCollection.find()[i].subject+"</td><td>"+scoreCollection.find()[i].unit+"</td><td>"+scoreCollection.find()[i].score+
     "</td><td><button id='extraBtn' class=\"btn btn-default\" data-id='"+scoreCollection.find()[i]._id+"'>備註</button></td></tr>"
    }
    $("tbody").append(scoredata);
   }
  );
  function inputModalTrigger(){
  $("#myModal1").modal();
  }
  
  
 function addCollection(){
  var newscore={
   date: $("#dateIpt").val(),
   weekday: $("select#weekdayS :selected").val(),
   subject: $("#subjectIpt").val(),
   unit: $("#unitIpt").val(),
   score: $("#scoreIpt").val(),
   extra: $("#extraIpt").val()
    }
   scoreCollection.insert(newscore);
   scoreCollection.save();
   showTable();
   $("#dateIpt").val("");
   $("select#weekdayS :selected").val("");
   $("#subjectIpt").val("");
   $("#unitIpt").val("");
   $("#scoreIpt").val("");
   $("#extraIpt").val("");
 }
 
  function showTable(){
    $("scoreTable").show();
    scoreCollection.load();
    $("tbody").text("");
for(var i=0; i<scoreCollection.find().length; i++){ 
   var scoredata =
       "<tr><td><input class='checkbox' type=\"radio\" value='"+scoreCollection.find()[i]._id+"'></td><td>"+scoreCollection.find()[i].date+
                  "</td><td>"+scoreCollection.find()[i].weekday+"</td><td>"+
    scoreCollection.find()[i].subject+"</td><td>"+scoreCollection.find()[i].unit+"</td><td>"+scoreCollection.find()[i].score+
    "</td><td><button id='extraBtn' class=\"btn btn-default\" data-id='"+scoreCollection.find()[i]._id+"'>備註</button></td></tr>"
}
   $("tbody").append(scoredata);
  } 
 
  function extraModal(){
   $("#myModal2").modal();
   var scoreid = $(this).data("id");
   var query={
     _id: scoreid
    };
    $("#test").text(scoreCollection.find(query)[0].extra);
  }
  $("table").on("click","button#extraBtn",extraModal);
  
  
  function deleteTable(){
    var checkList= []
    var target= $(".checkbox:checked").closest("tr");
    for(var i=0; i<target.length; i++){
    console.log(target[i]);
    checkList.push(target[i].value);
   }
   var result = scoreCollection.find({
     _id: {
       $in: checkList
      }
   }); 
   if(result!=""){ 
    var r = confirm("Are you sure?");
    if (r == true){
     scoreCollection.remove({
       _id: {
          $in: checkList
         }
     });
   } 
   if(result ==""){
    alert("尚未選擇");
   }
    scoreCollection.save();
    showTable();
   }
  }
   $("button#deleteBtn").on("click",deleteTable);
   
 </script>
 
</body>
</html>

